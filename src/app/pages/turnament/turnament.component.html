<div class="tournament-header">
    <h2 class="section-title">Turnering</h2>
    <button class="info-icon-button" (click)="openInfoModal()" aria-label="Informasjon">üõà</button>
</div>

<hr>

<!-- Pakk inn tabellen i en wrapper for horisontal scroll -->
<div class="table-wrapper">
    <table class="tournament-table">
        <thead>
            <tr>
                <th style="width: 1rem;">üèÜ</th>
                <th>Spiller</th>
                <th>Score</th>
                <th>Birdies</th>
                <th>Par</th>
                <th>Bogeys</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let row of rows; let i = index" (click)="openEditModal(row, i)">
                <td style="width: 1rem;" class="placement">{{ getPlacement(i) }}</td>
                <td class="player-cell">
                    <img *ngIf="getProfile(row['profile$id'])?.bilde" [src]="getProfile(row['profile$id'])?.bilde"
                        class="avatar" />
                    <span class="player-name">
                        {{ getProfile(row['profile$id'])?.fornavn || 'Ukjent' }}
                        <img *ngIf="i === 0" src="assets/yellow-t-shirt-icon.png" alt="Ledertr√∏ye"
                            class="leader-icon" />
                    </span>
                </td>
                <td>{{ row.total_score }}</td>
                <td>{{ row.total_birdies }}</td>
                <td>{{ row.total_par }}</td>
                <td>{{ row.total_bogeys }}</td>
            </tr>
        </tbody>
    </table>
</div>

<!-- Modal er uendret i struktur -->
<div class="modal" *ngIf="selectedRow">
    <div class="modal-content">
        <label class="modal-menu-button" [class.loading]="isOcrRunning">
            <ng-container *ngIf="!isOcrRunning; else loading">
                üì∑ Importer UDisc-bilde
            </ng-container>
            <ng-template #loading>
                <span class="spinner"></span> Laster...
            </ng-template>
            <input type="file" accept="image/*" (change)="onOCRImageUpload($event)" hidden>
        </label>
        <h2>
            {{ selectedProfile?.fornavn }}
            <img *ngIf="selectedIndex === 0" src="assets/yellow-t-shirt-icon.png" alt="Ledertr√∏ye"
                class="leader-icon" />
        </h2>
        <img *ngIf="selectedProfile?.bilde" [src]="selectedProfile.bilde" class="modal-avatar" />

        <div *ngFor="let field of editableFields" class="edit-field">
            <div class="edit-label">
                {{ field.replace('total_', '').toUpperCase() }}:
                <strong>{{ selectedRow[field] + currentSelectedRow[field] }}</strong>
            </div>
            <div class="edit-controls">
                <button (click)="adjust(field, -1)">‚ûñ</button>
                <span class="edit-value">{{ currentSelectedRow[field] }}</span>
                <button (click)="adjust(field, 1)">‚ûï</button>
            </div>
        </div>


        <div class="modal-actions">
            <button class="primary" (click)="saveEdits()">‚úÖ Ferdig</button>
            <button class="danger" (click)="removeRow(selectedRow); $event.stopPropagation()">üóëÔ∏è Slett</button>
            <button class="cancel" (click)="closeEditModal()">Avbryt</button>
        </div>
    </div>
</div>

<!-- Info-modal for bildeopplasting fra UDisc -->
<div class="modal" *ngIf="showInfoModal">
    <div class="modal-content udisc-info-modal">
        <h2>Last opp bilde fra UDisc</h2>

        <p class="info-text">
            N√•r du skal f√∏re score s√• kan du hente bildet fra udisc istedet for √• telle og trykke for hver birdie, par
            osv.
        </p>

        <div class="udisc-scroll-wrapper">
            <div class="udisc-step">
                <p class="step-caption">1. √Öpne runden din i UDisc og vis scorekortet. Trykk deretter p√•
                    <span class="bold-text">share</span> knappen
                    markert p√• bildet
                </p>
                <img src="assets/udisc-instruction-1.jpeg" alt="UDisc steg 1" class="udisc-image" />
            </div>

            <div class="udisc-step">
                <p class="step-caption">2. Velg deretter den som heter <span class="bold-text">Scorekort med min
                        statestikk</span> som markert under.</p>
                <img src="assets/udisc-instruction-2.jpeg" alt="UDisc steg 2" class="udisc-image" />
            </div>

            <div class="udisc-step">
                <p class="step-caption">3. Lagre bildet til telefonen og last opp det til appen n√•r du skal redigere p√•
                    score.</p>
                <img src="assets/udisc-instruction-3.jpeg" alt="UDisc steg 3" class="udisc-image" />
            </div>
        </div>

        <div class="modal-actions">
            <button class="primary" (click)="closeInfoModal()">Ait..</button>
        </div>
    </div>
</div>